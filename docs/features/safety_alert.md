# 安全与跌倒检测 (Safety & Fall Detection)

SilverLink 的核心安全功能，通过设备传感器实时监测长辈的安全状态，并在发生意外时自动触发警报。

## 功能特性

### 1. 跌倒检测
- **多重检测机制**：
    - **状态机算法**：监测典型的跌倒过程（失重 → 撞击 → 静止）。
    - **ML 分类器**：基于提取的加速度特征（如最大值、范围、标准差、变化模式）计算跌倒概率，提高准确率并减少误报。
- **灵敏度调节**：
    - 提供低、中、高三档灵敏度设置，适应不同身体状况的长辈。
    - **高灵敏度**：适合行动不便的长辈，更易触发。
    - **低灵敏度**：适合身体硬朗的长辈，仅在严重摔倒时触发。
- **防误触机制**：
    - 结合"静止检测"（Stillness Detection），确保只有在摔倒后无法自行站起时才报警。
    - "剧烈撞击"（Strong Impact）可绕过确认流程直接触发，应对极严重事故。

### 2. 紧急警报 (Emergency Alert)
- **本地警报**：
    - **全屏覆盖**：即使在锁屏状态下也会弹出醒目的红色全屏警报界面 (`FallAlertActivity`)。
    - **声光提示**：强制最大音量播放警报音，并伴随持续震动。
    - **屏幕常亮**：强制点亮屏幕 10 秒以上，方便长辈操作。
- **远程通知**：
    - 向家人端发送高优先级推送通知。
    - （计划中）发送短信或自动拨打紧急联系人电话。

### 3. 长时间久坐提醒 (Inactivity Alert)
- 结合主动关怀功能，如果检测到长辈长时间未移动且对唤醒无反应，也会升级为安全警报。

## 技术实现

- **FallDetectionService**: 
    - 前台服务，持有 `WakeLock` 确保 CPU 休眠时仍能监测。
    - 监听 `Sensor.TYPE_ACCELEROMETER` (加速度传感器)。
- **FallDetectionMLClassifier**:
    - 轻量级机器学习分类器，实时计算跌倒概率。
    - 特征工程：提取加速度向量模的统计特征（Max, Range, StdDev, FreeFallCount）。
- **WakeLock & Notification**:
    - 使用 `PowerManager` 强制唤醒 CPU 和屏幕。
    - 使用 `NotificationChannel` 的高优先级 (`IMPORTANCE_HIGH`) 确保通知穿透。

## 使用说明
用户需在设置中授予"身体传感器"权限，并建议开启"忽略电池优化"以保证服务稳定运行。
